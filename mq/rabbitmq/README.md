# RabbitMQ Server 高可用集群

## 设计集群的目的
	- 允许生产者消费者在 RabbitMQ 节点崩溃的情况下继续运行
	- 通过增加更多的节点来扩展消息通信的吞吐量

## 集群配置方式
	- *cluster*: 不支持跨网段，用于同一个网段内的局域网；可以随意的动态增加或者减少；节点之间需要运行相同版本的 RabbitMQ 和 Erlang。
	- *federation*: 应用于广域网。允许单台服务器上的交换机或队列接收发布到另一台服务器上交换机或队列的消息，可以是单独机器或集群。federation 队列类似于单向点对点连接，消息会在联盟队列之间转发任意次，直到被消费者接受。通常使用 federation 来连接 internet 上的中间服务器，用作订阅分发消息或工作队列。
	- *shovel*: 连接方式与 federation 的连接方式类似，但它工作在更低层次。可以应用于广域网。

## 节点类型
	- *RAM node*: 内存节点将所有的队列、交换机、绑定、用户、权限和 vhost 的元数据定义存储在内存中，好处是可以使得像交换机和队列声明等操作更加的快速。
	- *DISK node*: 将元数据存储在磁盘中，单节点系统只允许磁盘类型的节点，防止重启 RabbitMQ 的时候，丢失系统的配置信息。
	```
	问题说明：RabbitMQ 要求在集群中至少有一个磁盘节点，所有其他节点可以是内存节点，当节点加入或者离开集群时，必须要将该变更通知到至少一个磁盘节点。如果集群中唯一的一个磁盘节点崩溃的话，集群仍然可以保持运行，但是无法进行其他操作（增删改查），直到节点恢复。
    解决方案：设置两个磁盘节点，至少有一个是可用的，可以保存元数据的更改。
	```
